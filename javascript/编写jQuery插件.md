## 编写jQuery 插件

> 参考来自《锋利的jQuery》的一书


### 1. 插件的种类

编写插件的目的： 对一系列方法和函数做一个封装，以便在其它地方重用


锋利的jQuery主要分为3种类型：

1. 封装对象方法的插件

将对象的方法进行封装，通过选择器获取的jQuery 对象，就可以使用该对象。

95%以上的插件都是封装对象方法的插件。有相当一部分的jQuery的方法，都是在jQuery脚本库内通过这种形式"插"在内核上的。如 `parent()`、`appendTo()`、`addClass()`等
不少DOM操作方法。

2. 封装全局函数的插件

可以将独立的函数加在jQuery命名空间下，如`jQuerynoConfict()` 、`jQuery.ajax()`、`jQuery.trim()`等，都是jQuery内部作为全局函数的插件附加到内核上去的。

3. 选择器插件

虽然jQuery的选择器十分强大，但还是会需要扩充一些自己喜欢的选择器，如color(red)来选择所有红色字的元素之类的想法。

### 插件的基本特点

* 命名推荐： jquery.[插件名].js,避免和其它js库插件混淆

* 所有的对象方法都应当 附加到jQuery.fn对象上，所有的全局函数都应附加到jQuery对象本身上。

* 在插件内部，this指向的是当前通过选择器获取的jQuery对象，而不像一般的方法那样。例如`click()`方法，内部的this指向的是DOM元素。

* 可以通过this.each来遍历所有元素。

* 所有的方法或者函数插件，都应当以分号结尾。否则压缩的时候可能出现问题，为了更稳妥些，甚至可以在插件头部先加上一个分号，以免他人的不规范代码给插件带来的影响

* 插件应该返回一个jQuery对象，以保证插件的可链式操作，除非插件需要返回的是一些需要获取的量，如字符串或者数组等。

* 避免在插件内部使用`$`作为jQuery对象的别名，而应使用完整的jQuery来表示。这样可以避免冲突。当然，也可以利用闭包这种技巧来回避这个问题，使插件内部继续使用`$`作为jQuery的别名。



### 插件中的闭包

利用闭包的特性，可以避免内部临时变量影响全局空间，又可以在插件内部继续使用`$`作为jQuery的别名。

**常见的jQuery插件结构**

```$xslt
//注意为了更好的兼容性，开头加个分号
;(function($){  // 此处将$作为匿名函数的形参
    /*这里写代码，可以使用$作为jQuery的别名*/
})(jQuery);    // 这里将jQuery作为实参传递给匿名函数
```
**一个简单闭包介绍**

```$xslt
;(function($){
    //这里编写插件的代码，可以继续使用$ 作为jQuery 的别名
    //定义一个局部的变量foo,仅函数内部可以访问，外部无法访问
  
    var foo;
    var bar = function(){
        /*
            在匿名函数内部的函数都可以访问foo,即便是在匿名函数外部调用bar()的时候，也可以在bar()的内部访问到foo,但是在匿名函数的外部直接访问foo是做不到的
        */
    }
    
    /*
        下面的语句让匿名函数内部的函数bar()逃逸到全局可访问的范围内，这样就可以在匿名函数的外部通过jQuery.BAR()来访问内部定义的函数bar(),并且内部函数bar()页能访问匿名函数内的变量foo
    */
    
    $.BAR = bar;
})(jQuery)

```

### jQuery 插件的机制






























